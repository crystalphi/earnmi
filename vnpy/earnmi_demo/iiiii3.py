from collections import defaultdict
from dataclasses import dataclass
from datetime import datetime
from functools import cmp_to_key

import numpy as np
import talib

import time
import sched

from earnmi.chart.KPattern import KPattern

from earnmi.chart.Chart import Chart
from earnmi.chart.Indicator import Indicator
from earnmi.chart.KPattern2 import KPattern2
from earnmi.core.App import App
from earnmi.core.analysis.FloatRange import FloatParser, FloatDistribute
from earnmi.data.driver.ZZ500StockDriver import ZZ500StockDriver

from earnmi.uitl.BarUtils import BarUtils
from vnpy.trader.constant import Interval

value_list = [-4.69576719576719, 0.5453306066803125, -2.7831715210356025, -5.877989987020214, -7.79132791327914, -1.3874788494077839, 3.749695641587536, -3.138252756573372, 6.835330670217492, -5.252274607113322, -14.139784946236562, -2.2605363984674396, -2.242345838723582, -4.042806183115337, 11.613876319758694, -8.174386920980934, 5.189340813464238, -3.1813865147198395, -1.5272244355909605, 14.121368996261161, 6.2594268476621355, 7.635009310986968, -2.1228822208613845, -18.78415300546448, 3.9631988676574825, 1.5443345479784842, -1.2658227848101318, 19.362430466409933, -0.8686210640608091, 21.682847896440112, 0.8680555555555525, 20.10309278350516, -3.5999999999999943, 2.7642276422764436, 3.3282130056323624, -1.4336917562724105, -0.08960573476702716, 6.77458033573142, 4.9828178694157925, -13.43390804597702, -0.04522840343735368, -2.908667830133804, 27.18855218855218, -8.591065292096209, 8.78552971576227, -0.8782936010037677, -9.971321420692695, 10.549645390070918, 22.947469647794208, -2.4356297842728005, -5.643340857787811, -2.659574468085097, 1.336302895322931, 50.70575461454942, -2.890173410404631, 0.9341199606686351, 49.13249211356467, -5.308501203598131, 2.109704641350226, -1.1841326228537554, -13.26140705776578, -0.436827956989244, 2.9742473703300703, 10.541813898704358, 5.204301075268829, 0.435374149659874, -10.14168530947054, 17.849462365591396, -4.728682170542632, 3.21678321678321, -1.9047619047619064, -11.200487507617316, 4.441624365482217, -0.30406689471682447, 12.335958005249342, 2.0933977455716644, 7.4694589877835895, 1.0624169986719856, 5.40061974324922, 2.648505486189946, -9.944968553459123, -1.2578616352201213, 0.9645061728394924, -2.206736353077811, 2.9245596543702197, -1.8558172733761646, 2.6045086452177593, 4.995458673932795, -0.6681514476614755, -8.39328537170263, 7.647547797173732, 1.3477088948787135, -2.1276595744680873, -10.426179604261772, -6.071677105080031, 16.050686378035895, 8.113590263691691, 0.6915629322268486, -0.5942275042444696, 14.636840651753666, 5.757052389176741, 15.092149180089981, 16.798941798941815, 0.3790750568612639, -4.892966360856268, -10.274669379450676, -2.153209109730865, 1.2569832402234618, -11.174968071519789, 0.6666666666666722, 13.687043444828921, 26.25570776255709, 5.702306079664578, 7.420494699646631, 12.942061700526711, 7.094918504314481, -4.0767386091127085, -0.396825396825406, -5.670376258611554, -7.581120943952809, -11.033843300880848, -3.1182795698924735, 11.674150096215525, 4.066374908825669, -5.2648897663705325, -1.1511511511511576, -0.4521963824289424, 0.3728560775540827, -4.818325434439174, 3.7815126050420234, -13.559941520467833, -0.8264462809917388, 2.4618414574101473, 9.957498482088633, -7.0306038047973605, 2.61044176706828, 4.792575663134562, -3.7825059101654777, 2.919708029197083, 0.12033694344163937, 1.5625000000000016, 0.930626057529621, -4.616619831393009, 3.1007751937984387, 8.737108386845689, 1.5027322404371606, -3.189792663476863, 2.169846614291059, -0.22552999548941133, -4.012345679012351, -2.7062706270626897, 10.796857463524107, 0.48939641109298937, -5.289993626513698, 0.0, -3.6024305555555522, 5.279831045406547, 4.339796860572498, 5.653883972468049, -7.764390896921035, 2.0304568527918687, 4.670094258783193, 19.247594050743647, -3.9708091865207042, -13.333333333333321, 0.44808104422365863, -4.122807017543861, 2.3726851851852016, 0.47169811320755806, -2.3662551440329214, 7.5284612559676845, 2.408935567225134, 17.674074074074056, -5.007153075822605, 2.3552894211576914, 9.46236559139784, 1.1975390024170511, -0.3350083752093768, 5.765199161425571, -5.015873015873005, 0.9592326139088738, -0.33927056827820967, 1.0752688172043074, -1.4986705342035187, -1.8342820999367493, -7.451403887688979, 1.656920077972709, -4.359490274983235, 28.486204325130483, 0.7319819819819914, -3.946441155743497, -11.801919720767886, 3.4951456310679556, -0.833333333333344, -0.11716461628588436, 2.023031434796142, 4.3662430759205, 10.093523910358211, -3.6714975845410396, -7.8849407783418, -0.6980802792321162, 9.62199312714777, 0.7924836601307297, -7.246680642907051, -6.878817100610738, -13.73358348968105, -8.540751586139576, 6.719999999999984, -3.9262820512820347, 3.8002171552660307, -2.5559105431309788, 11.57407407407408, 8.169934640522875, -1.0449320794148529, -0.9584664536741387, -5.635648754914806, 0.14880952380953122, -0.364697301239963, -1.6771488469601508, -4.175222450376451, 5.5422647527910645, 0.28835063437139974, -1.892641540218633, -4.611732790776532, -1.415929203539824, 15.896487985212573, -4.033613445378155, -3.8983050847457545, -2.1276595744680873, -4.176904176904185, 1.8918918918918874, 9.2911877394636, -6.842737094837928, -3.889585947302379, 1.4598540145985088, -3.2010081915563857, -8.095238095238091, -2.1790341578327554, -6.769825918762082, 0.6048387096774065, 1.3678905687545218, 51.37481910274962, -5.45396214308631, -0.40496076942547127, -0.05767012687428814, 2.2659511031603943, 1.9673974142776922, 3.892944038929449, 4.221927497789567, 0.6349206349206284, -16.042584434654934, -5.671077504725911, 7.2527472527472545, 0.8871989860583053, 5.717761557177601, 5.186385737439212, 2.906162464986001, -12.514619883040949, -4.999999999999996, -13.284753363228706, -15.06238859180037, 9.482220835932623, -14.793467819404414, -2.3894862604540097, -11.036036036036036, 9.82228626320844, -10.434782608695643, 1.4134275618374414, -3.7598204264871122, 4.569288389513104, -1.2681159420290027, -13.767153607791064, 3.860856269113142, 3.3232628398791504, 4.375359815774317, 19.64980544747081, 0.9926854754440843, -6.810035842293909, 1.9580419580419535, -5.856595511767922, -8.389513108614226, 14.29769392033544, -5.49019607843136, 2.6588845654993527, -2.245614035087715, -13.74269005847952, 2.291666666666664, -5.658056580565805, 1.8439716312056784, 1.6927083333333377, -9.083119108826054, -1.9694297472075195, -2.4029574861367817, -4.320987654320988, 7.820136852394929, -0.40983606557377994, -5.794392523364496, 6.104868913857674, -1.0802469135802513, 10.701754385964902, 4.363267376965999, -6.001188354129534, 2.61860751694393, -4.242424242424241, 4.991948470209348, -11.785400175901485, -1.8162393162393295, -3.1936127744511054, -8.581436077057797, 9.829763866007688, -4.09836065573769, 1.1945392491467473, -5.940594059405935, 13.305613305613319, -2.762084118016302, -7.610062893081745, -5.844748858447478, -4.593175853018374, -1.244813278008309, -7.02541106128551, 6.915254237288146, 1.910112359550561, 4.070317782285344, -11.065235342691974, 21.230158730158735, 1.7031630170316208, -11.533052039381138, 2.212199312714768, 1.203171998906206, 1.4647415777359116, -7.8990494919698415, 9.391891891891895, -1.963654104159039, 9.909297052154196, -7.533241632278782, 4.086021505376359, -1.1265738899933726, -2.6631739794804488, 0.8323424494649261, 4.743143363264306, -5.195453977769465, -22.199312714776624, -7.171652875026523, 12.903758777364736, 0.13190126248351286, -19.291743874819844]
value_list = [9.803921568627445, -14.814814814814817, 3.49127182044887, -0.8239700374531725, 0.22831050228312044, 17.118499573742525, -3.6045140643422497, -4.267161410018544, -4.4402751719825, 2.2927689594356244, -11.0396570203644, 0.41215868109223003, -2.6130424903431004, 2.2088353413654596, 6.867112100965093, -6.869633099141288, 7.417458163726823, -3.377777777777773, -7.220767888307145, 11.077420658985252, -0.4345127250155201, 0.4122497055359106, 5.5444887118193895, -11.92118226600986, -6.67458118981665, -1.2246658042259486, 3.658536585365853, -4.596162427487734, -9.993011879804332, 6.3968015992004, 4.363001745200698, 5.169985918326286, -2.7508090614886935, 3.587443946188344, 1.7950842308754498, -4.5007032348804605, 1.2420275260154388, -16.722037652270213, -0.2734277902063034, -6.83760683760684, -1.851851851851851, -8.940397350993377, -4.797979797979801, -3.366583541147127, 8.260292164674624, -0.6642512077294599, 0.3243243243243174, 3.329633740288576, -3.46841913106975, -5.085986095865345, -10.510948905109485, -5.3308823529411935, 6.244725738396611, -0.7201646090535008, 6.9667738478027905, -0.6054131054131052, -7.990012484394503, 11.437246963562743, -4.2430086788813846, -1.4659018483110344, -10.934182590233544, -0.12437810945272261, 8.483128350678019, 4.413472706155626, -13.90868302982318, -0.607760635811122, 4.135525660189346, -13.470533208606168, -8.27886710239651, -0.15629440181869264, -11.916607438995506, -9.705177034842698, -2.543640897755601, -2.0010744023636833, -2.8571428571428603, 3.7681159420289845, 2.6993865030674704, -10.92468307233407, -4.7589229805886015, 1.6393442622950833, 2.5607638888888844, 4.0822072072072, -8.12182741116752, -14.92743607463718, 11.955241460541814, -10.256410256410271, 12.854221443178485, 3.1624863685932296, 6.332599118942723, -20.332552170516685, -18.018632129061583, -14.837819185645268, -6.183789110618374, 2.47619047619047, -10.288582183186955, -0.6875477463712747, -1.5743756786102066, -2.6591458501208853, 10.567780494430878, 10.462886880306765, 6.666666666666678, 14.155251141552514, 5.334692490655794, 1.8973695558430221, 12.839879154078545, -5.831798649478204, 3.823661718398571, 8.976464148877945, -27.369007803790414, 9.876543209876534, 14.787752261656243, 0.2614379084967381, -4.7863247863247835, 10.722610722610723, -1.3664874551971313, 2.6543727298128097, -19.30107526881721, -0.21834061135370714, 3.6596523330283492, 12.02749140893472, 2.2744220730797893, 2.588996763754048, 9.619686800894868, 5.712280701754382, 9.240759240759248, -8.154761904761896, 2.022178734507505, 9.534706331045005, 10.016501650164999, 6.140350877192988, 10.102489019033682, 22.402246705551956, 10.799999999999997, -4.680069174232604, -1.3756613756613651, -5.975500448162534, -2.1585279547062965, 1.7624521072797037, 6.084840055632823, -3.860379103097537, -5.741360089186182, -3.8868388683887014, 5.094850948509487, -3.0685920577617316, 0.6421152030217184, 0.21827252884315648, 0.28355387523628883, -1.7268445839874322, 0.19930244145489914, -9.36147186147187, 7.922535211267609, 2.5641025641025483, 14.261460101867584, -10.449129239230086, 11.512995355272281, -4.906666666666661, 1.8216421968461216, 4.106548279689245, 1.515151515151524, 6.839622641509434, 7.175141242937845, -3.8626609442060023, 2.5132275132275184, 2.331895863280633, 2.306229196386121, 12.82361237030321, 3.308596165739013, 2.3437499999999893, -14.719173660426089, 0.45395590142672043, -5.322862129144862, -9.260563380281686, 13.880266075388006, 0.6433823529411791, -0.8322929671244359, 16.533864541832692, 2.4528301886792434, 6.467181467181484, 7.720685111989446, 1.335055986218779, -13.787204926445439, 20.995741893219794, -7.008830022075072, -9.484492431459717, 1.7793083656191735, -9.097385481228184, 7.664482664482662, 4.081073678444257, 12.639757437938218, 1.145833333333346, -7.257072570725695, -1.6687526074259542, -0.5855562784645288, 1.1111111111111072, 3.2768361581920904, -0.10256410256410493, 2.8639618138424634, -5.128205128205136, -0.18552875695732443, 6.764295676429547, 12.76181926989825, -5.9766576888546785, 0.6033182503770678, 3.965702036441578, -4.85084306095979, 16.519694297472075, -9.637681159420284, 0.8061265618702108, -14.109347442680773, 7.309941520467849, -7.4020319303338145, 9.220416011186853, -7.058068655758751, 23.750397962432324, -8.314606741573055, 2.395040856579332, 25.61382832449421, 12.558922558922548, 19.073735527117606, -9.454038025466607, 0.6375227686703122, 0.4286185295087515, -0.27378507871321645, 38.66882241983293, 3.276108726752497, -4.7939068100358515, 4.726368159203976, -4.324078288575327, 4.664970313825271, 0.8627450980392298, -6.185471976401155, -12.49221183800621, 15.717574827321558, 0.38131553860820144, 15.495845473184424, 12.824646247537167, 7.262845849802367, 6.797706797706777, 10.362047440699133, 0.8565310492505361, -8.033573141486821, -12.94810058855004, 1.2307692307692455, 2.306425041186156, -1.534803285776035, -4.624688722874406, -7.914764079147647, -5.845051006341332, 7.075732448866778, -2.905982905982905, 0.6006006006006012, -1.7980636237897694, 6.004140786749483, -8.775981524249431, -5.208333333333315, 22.677234698370757, -4.671218109953278, -11.236933797909415, 5.015353121801436, 1.167608286252376, -2.7727546714888325, -0.7921998781230897, 3.679175864606315, -8.333333333333337, 4.909028492962562, -0.27266530334015626, 5.333333333333334, -10.035133948177426, 3.4571474513587486, 6.09799083538951, -4.54545454545454, -2.9803921568627514, 10.052910052910063, 4.057017543859626, -0.8564576909900712, 9.979481440029835, 1.5151515151515045, -17.945075757575754, 8.495117072596775, -2.407002188183806, -1.617608061522141, 6.866197183098602, -1.8481848184818381, 17.012227538543325, -8.805031446540887, 1.5350877192982373, -2.3133543638275613, -0.856389986824763, 11.592879963486988, 3.8576051779935097, 5.433080351764836, -2.4353120243531157, 0.23501762632196915, -6.393544382371205, -3.934010152284259, 9.088787772721972, 3.8828720417168157, -7.1084678561314165, -0.7153075822603885, -2.1929824561403435, 12.484848484848483, -5.480984340044751, 6.838709677419347, -13.09226932668329, -0.09647853352629263, 5.967540574282149, 1.473296500920828, 3.8629283489096804, -1.3921113689095037, -12.154294032023289, 2.6114649681528674, 1.129326047358836, 1.4181577203446232, 4.3230944254834975, 0.1960784313725405, -15.422885572139297, -4.365983295368256, 23.527625986642366, 12.938733125649021, 5.412054120541216, 1.986754966887419, 7.407407407407395, -11.331444759206784, -1.9065190651906385, -7.212121212121226, 12.330986702424857, 15.610859728506775, 5.036447978793896, 11.16666666666668, -7.052257737189252, 12.035496394897415, -4.960593416782578, -4.494382022471914, -5.670289855072462, -8.696916812100069, -0.8648648648648656, -2.0120724346076386, 0.606641123882513, 3.401909372058642, 12.880804495711326, -4.032100215306326, -1.1596180081855383, 1.2234255916566374, -6.309611151870868, -0.022222222222237537, -7.74862721171445, -7.270486752926677, 6.786342837029211, -5.973715651135, 1.6771488469601505, -3.921568627450975, -0.3021562972119101, 0.6493506493506499, 0.2123142250530693, -4.938271604938276, 3.7878787878787743, -1.5476190476190357, 0.440705128205133, 5.039073026138506, -1.7819706498951913, 12.463768115942033, 4.86358244365362, -2.4028268551236738, 12.092534174553105, -5.4024255788313145, -4.767225325884535, 23.22026800670015, -9.901556776556774, 3.9974210186976036, 0.10162601626016496, 0.6259780907668209, -0.3407682775712388, 2.5039123630672835, -1.8683651804670893, -2.333333333333329, 1.6212710765239948, 2.3764056863993077, -12.468671679198007, -1.5602836879432607, 7.704042715484367, -5.879692446856618, 6.734006734006727, -0.37878787878788034, -10.684671878701746, -11.173184357541889, -2.4965325936199685, -6.221408966148213, 16.289486091466273, 8.760064412238332, 18.246292714377823, 11.348600508905863, 8.411214953271042, -3.9862098685628125, -9.241452991452984, 17.274939172749384, -1.5842839036755332, -3.115264797507791, -13.333333333333329, 2.8106852497096586, 14.666666666666671, 3.7581699346405224, 3.0637254901960675, 4.096834264432025, -1.7078916372202593, 1.0101010101010097, -2.98810559907166, -1.2903225806451624, 0.9803921568627387, -1.1363636363636458, -0.9456264775413773, 11.384615384615378, 5.08892410635676, 0.02266032177656069, -3.7735849056603805, 14.48717948717948, 1.6489988221436895, -4.150277357539081, 24.666228934121232, 5.287677614721647, -15.391266753134456, 3.2407407407407387, -0.134952766531717, 1.477199743095688, 2.638727202173089, 13.422818791946321, -14.950980392156849, 13.437499999999977, 2.4967574578469622, 1.933551198257078, 11.507191994996855, -2.8899835796387485, 3.289057558507266, -0.5344021376085449, 1.1470985155195497, 8.045977011494248, 3.86130811662726, -2.912186379928317, 6.239460370994943, 7.656193571686533, 5.858310626702994, -7.990867579908662, -3.0303030303030303, 10.691823899371064, -2.9137529137529348, 41.45299145299146, 3.4938621340887726, 0.7042253521126767, 0.8303677342823284, -0.19735543714230308, 0.7003891050583647, 12.029795158286793, -5.384150030248021, 4.848484848484853, 6.27893518518518, -2.8654048370136556, 3.9682539682539733, 2.6814268142681423, -1.5873015873015939, -12.514220705346986, 9.006734006734002, -0.14534883720929923, 11.991434689507486, -4.573512906846252, 43.7007874015748, 3.4299034299034337, -3.1478358628442926, -1.8296169239565432, -5.361305361305345, 7.342657342657358, 26.452189454870425, 4.739336492890993, 3.333333333333336, 5.807711078574912, 0.9687362395420508, 3.0282787797817727, 13.089225589225595, -11.291224147568482, 3.865936618549862, 2.545003103662322, -4.186684969114615, -6.322843822843818, 6.195786864931858, -1.4184397163120424, 2.301034409964112, -6.490163633020772, -7.662835249042138, -10.551876379690952, 5.224371627845787, 8.51897689768976, -9.491244430628965, 1.5826990455479066, 0.7646854362182913, -6.392346922613964, -9.470899470899472, 0.7803790412486096, 1.3136288998357892, -5.6759098786828375, 2.426600441501099, 28.225244072524397, 0.07355645457887466, -8.86252616887648, 4.602888086642613, 1.0258037225042327, 4.9940101826894345, 14.124293785310735, 1.7756255044390619, -18.49227438244267, -1.7906336088154342, 14.163686928883582, 4.330566582461203, 2.7420736932305143, -0.2562788313685508, 11.27913182707704, 4.984220263358366, -1.659611637438683, 5.888996450467902, 8.018491949625393, 13.877224555088977, -0.6163708086784923, -14.154137884328868, 8.054433046661838]
fParser1 = FloatParser()
fParser2 = FloatParser()

print(f"f1: {fParser1.calc_avg_line(value_list)}")
#
fParser1.showPipChart(value_list,limit_show_count=8)
fParser1.showLineChart(value_list)




